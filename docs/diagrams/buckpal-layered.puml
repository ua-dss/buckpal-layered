' Generated by UML Generator
' Encoded: pLXRRzis57xFhz2ZlSH6zYgqHftBXWnfqoLkDtGO2bfY72wKgEgIDElQtxv3YgHubOoW3tqetF1S-9qBoU_eLTEYkkqAUj3Sax92DIgIZAAcMRTjJRPTYoyoLjwGVt5oV717SfnafCueFZWGMib9bzs_HVIKbRTarzMe9QnyMxCArot1JVBb84aMROtAvXRNcxiQDtUCvcb2MRbBNYQNyBDylVxpu_lrvRlpWw-ErtLLKP89dyBJuHT0svBiQr8WKivGlMlIv0Pmbhk__fwdoGCZ-U1adMMiAzlNg08qlNs1gWqxOzpwl6n9-pH3lLAgj7-hK2yvIb3MaWV2mqYJIzAqBzRzmfFMMSsr7NZ_9hmhfJz8cRF7sRvEJ2EDLEieDq-3gc6brSpOUr5V098FoXSvNs6F9Qubz8jSHx7KIrofOLsTuIajw9yTRYUrI86XU4K5QM0PecUenHjOuxA2bHWYUyr_-DyBdW25TpO9zIYP1dgKJCC4dGZ8eyI4EFVJV97tYNv0jCEfQ6kl3yrI68dPeWPJKk8JH56POICDo6gAG9FqYT9duf6qTwm3jxEmJztH4OzMCzjkmIVoCiSpzZrsWhA0VrYxglX9H_I5tc35vL28hADG2ha9LrL9uiQXPGuwhz7Zp2nSl0akSZ3UCaOnAaL78a0Qy61f7UQuOWrfdJrYpMZjuJR7Q0C9nyu5-E7y-afk2VUe-5soszdnvLoqJj5VQYTaTr6sU8ThtIwaUSj1amTyLN_0DPlPCP7c3TuXBlO4oiuJ_5fZg0vSxwYygiy_TOXks4ZQB8CHFHqhn2NpmfyDiynQ1UNGeRe4sy6VLYr8sJNkRbfQqH6XtgNfjl2MPUt4LYNFeD6FtdNHduA-uj47OkLTXLDFoce-eQtV3dboRlZRlr6N7WVitirSwxpCntMy0uf6RbddyAurFE7QJS0X55Q_1C57CFZcIo0tk7uW6LQ95gBh_j2o-ibyyuTLy-QrTVLZwoeRD2ErMOSkuN3hg1nzwh01GQx-pXT3VIEKplfzVvoer0MOiQ90vL1j2VIqNnwvzdYzrvJ-E15H3gYNc0qf5bOUVFL6_3ZuzRldbaH17Qc9QBgDvEekXo_GPr9qnSQdyjuRzFF7u-DZ_kzoxcNiLDpypysN234JBgIA5sU_mH3bmBLSA3Uup0NcxrczBGmk5QBB7BLeMMl1SgggSAVUwvtu7veN-mL9OvNQkqiQ5RgNFfqKlq_0EBl3sRqk_Jx6zksiJSy_PnZdMFnMmtWNbyzQf-44nGIcuNFoq4GgfxzmscRRqHasdPXnv_5w02O2zAk-HT1UHd45d6yK_gVQ68NfeaWVgDOOIj3WVRHr7jwmgyhTyt3_FG-ViwUYY28Xxn4bS0wOdBr98nOKbPDLp1Waw3DGLSXk0-GAygNjJdjPwAwIEggq2qtH7fHncWpxluHpIMX-XczHHmV_lq0BmJ6SpPVmFElLsTmVhQHNF0C6-0_E0Ex6YDsiSU2OzzM-1JfsydJ5Xrblf9MqDl9zW5i3GFceIgRm3cJKB0htSPHqVDcXQEPanGSBvL0z2OX-3v-XNdVJu15X7UGm78lHP-A3GIX_mGyMIk3DVKgW1YKQcjX7q7bpRt3abrBUnpMZL7w5KdUqJLBJC7TLlVZDPv16eIxx1fAIQznKS9fm_Cbp4JNEMvZ67ibdmn-U7Az8bwBBl1Browf0CaAD9nhZG7I2INSeMngXSi-EKnCmD169sZ0QY68oTXWM-t4nMUnAGx894odXXjP7NiFfJQDWDACF9jKUJDBmlFBibAefOogZShje37BOS6CmAR-Bo9vFDABGb61kQtzvNYvNteqILmbAh0z_SOKHaRcp_3Jyqs9XVXLsrXLjjfRxkLHzq7GLXzMGNYW6A_1-a5WiLjhS-bh232-kp71ZG3Q45Y3dwu0HXatFnzH3T7xIlQJXOJqFfZFkJy4Cge_0ZBktOJep-XICeFe8ZBXx6uOxQq_X2EkF01dPG2A93SXUnzjJxXHIMzjjvV2iEkKpOZ0I_jWMOY0TquiDG7lubhaT6Gs7Wn4SxRXuV4ABsqtW5dEJNH1tgbek_rjPQV8LJFF8W1IxeeotoaYPyqwEa3l3o6Do-vc5zmgGBCF6vL9x6OKtyaYGOM6pdIXHCImSGhAFIHYMJoNCqsAJXbUGuAwW_mC
' URL: http://www.plantuml.com/plantuml/uml/pLXRRzis57xFhz2ZlSH6zYgqHftBXWnfqoLkDtGO2bfY72wKgEgIDElQtxv3YgHubOoW3tqetF1S-9qBoU_eLTEYkkqAUj3Sax92DIgIZAAcMRTjJRPTYoyoLjwGVt5oV717SfnafCueFZWGMib9bzs_HVIKbRTarzMe9QnyMxCArot1JVBb84aMROtAvXRNcxiQDtUCvcb2MRbBNYQNyBDylVxpu_lrvRlpWw-ErtLLKP89dyBJuHT0svBiQr8WKivGlMlIv0Pmbhk__fwdoGCZ-U1adMMiAzlNg08qlNs1gWqxOzpwl6n9-pH3lLAgj7-hK2yvIb3MaWV2mqYJIzAqBzRzmfFMMSsr7NZ_9hmhfJz8cRF7sRvEJ2EDLEieDq-3gc6brSpOUr5V098FoXSvNs6F9Qubz8jSHx7KIrofOLsTuIajw9yTRYUrI86XU4K5QM0PecUenHjOuxA2bHWYUyr_-DyBdW25TpO9zIYP1dgKJCC4dGZ8eyI4EFVJV97tYNv0jCEfQ6kl3yrI68dPeWPJKk8JH56POICDo6gAG9FqYT9duf6qTwm3jxEmJztH4OzMCzjkmIVoCiSpzZrsWhA0VrYxglX9H_I5tc35vL28hADG2ha9LrL9uiQXPGuwhz7Zp2nSl0akSZ3UCaOnAaL78a0Qy61f7UQuOWrfdJrYpMZjuJR7Q0C9nyu5-E7y-afk2VUe-5soszdnvLoqJj5VQYTaTr6sU8ThtIwaUSj1amTyLN_0DPlPCP7c3TuXBlO4oiuJ_5fZg0vSxwYygiy_TOXks4ZQB8CHFHqhn2NpmfyDiynQ1UNGeRe4sy6VLYr8sJNkRbfQqH6XtgNfjl2MPUt4LYNFeD6FtdNHduA-uj47OkLTXLDFoce-eQtV3dboRlZRlr6N7WVitirSwxpCntMy0uf6RbddyAurFE7QJS0X55Q_1C57CFZcIo0tk7uW6LQ95gBh_j2o-ibyyuTLy-QrTVLZwoeRD2ErMOSkuN3hg1nzwh01GQx-pXT3VIEKplfzVvoer0MOiQ90vL1j2VIqNnwvzdYzrvJ-E15H3gYNc0qf5bOUVFL6_3ZuzRldbaH17Qc9QBgDvEekXo_GPr9qnSQdyjuRzFF7u-DZ_kzoxcNiLDpypysN234JBgIA5sU_mH3bmBLSA3Uup0NcxrczBGmk5QBB7BLeMMl1SgggSAVUwvtu7veN-mL9OvNQkqiQ5RgNFfqKlq_0EBl3sRqk_Jx6zksiJSy_PnZdMFnMmtWNbyzQf-44nGIcuNFoq4GgfxzmscRRqHasdPXnv_5w02O2zAk-HT1UHd45d6yK_gVQ68NfeaWVgDOOIj3WVRHr7jwmgyhTyt3_FG-ViwUYY28Xxn4bS0wOdBr98nOKbPDLp1Waw3DGLSXk0-GAygNjJdjPwAwIEggq2qtH7fHncWpxluHpIMX-XczHHmV_lq0BmJ6SpPVmFElLsTmVhQHNF0C6-0_E0Ex6YDsiSU2OzzM-1JfsydJ5Xrblf9MqDl9zW5i3GFceIgRm3cJKB0htSPHqVDcXQEPanGSBvL0z2OX-3v-XNdVJu15X7UGm78lHP-A3GIX_mGyMIk3DVKgW1YKQcjX7q7bpRt3abrBUnpMZL7w5KdUqJLBJC7TLlVZDPv16eIxx1fAIQznKS9fm_Cbp4JNEMvZ67ibdmn-U7Az8bwBBl1Browf0CaAD9nhZG7I2INSeMngXSi-EKnCmD169sZ0QY68oTXWM-t4nMUnAGx894odXXjP7NiFfJQDWDACF9jKUJDBmlFBibAefOogZShje37BOS6CmAR-Bo9vFDABGb61kQtzvNYvNteqILmbAh0z_SOKHaRcp_3Jyqs9XVXLsrXLjjfRxkLHzq7GLXzMGNYW6A_1-a5WiLjhS-bh232-kp71ZG3Q45Y3dwu0HXatFnzH3T7xIlQJXOJqFfZFkJy4Cge_0ZBktOJep-XICeFe8ZBXx6uOxQq_X2EkF01dPG2A93SXUnzjJxXHIMzjjvV2iEkKpOZ0I_jWMOY0TquiDG7lubhaT6Gs7Wn4SxRXuV4ABsqtW5dEJNH1tgbek_rjPQV8LJFF8W1IxeeotoaYPyqwEa3l3o6Do-vc5zmgGBCF6vL9x6OKtyaYGOM6pdIXHCImSGhAFIHYMJoNCqsAJXbUGuAwW_mC
' Generated on: 2026-02-27T13:39:00.139300631

@startuml
skinparam classAttributeIconSize 0
hide circle

class BuckPalConfigurationProperties {
  -transferThreshold: long = Long.MAX_VALUE
}

class BuckPalApplication {
  +{static} main(args: String[]): void
}

class AccountMapper {
  +mapToDomainEntity(account: AccountJpaEntity, activities: List<ActivityJpaEntity>): Account
  ~mapToActivityWindow(activities: List<ActivityJpaEntity>): ActivityWindow
  +mapToJpaEntity(activity: Activity): ActivityJpaEntity
}

class Activity {
  -id: ActivityId
  -ownerAccountId: Account.AccountId
  -sourceAccountId: Account.AccountId
  -targetAccountId: Account.AccountId
  -timestamp: LocalDateTime
  -money: Money
  --
  +Activity(ownerAccountId: Account.AccountId, sourceAccountId: Account.AccountId, targetAccountId: Account.AccountId, timestamp: LocalDateTime, money: Money)
}

class ActivityId {
  -value: Long
}

class Account {
  -id: AccountId
  -baselineBalance: Money
  -activityWindow: ActivityWindow
  --
  +{static} withoutId(baselineBalance: Money, activityWindow: ActivityWindow): Account
  +{static} withId(accountId: AccountId, baselineBalance: Money, activityWindow: ActivityWindow): Account
  +getId(): Optional<AccountId>
  +calculateBalance(): Money
  +getBalance(): Money
  +withdraw(money: Money, targetAccountId: AccountId): boolean
  -mayWithdraw(money: Money): boolean
  +deposit(money: Money, sourceAccountId: AccountId): boolean
}

class AccountId {
  -value: Long
}

class Money {
  +{static} ZERO: Money = Money.of(0L)
  -amount: BigInteger
  --
  +isPositiveOrZero(): boolean
  +isNegative(): boolean
  +isPositive(): boolean
  +isGreaterThanOrEqualTo(money: Money): boolean
  +isGreaterThan(money: Money): boolean
  +{static} of(value: long): Money
  +{static} add(a: Money, b: Money): Money
  +minus(money: Money): Money
  +plus(money: Money): Money
  +{static} subtract(a: Money, b: Money): Money
  +negate(): Money
}

class ActivityWindow {
  -activities: List<Activity>
  --
  +ActivityWindow(activities: List<Activity>)
  +ActivityWindow(activities: Activity)
  +getStartTimestamp(): LocalDateTime
  +getEndTimestamp(): LocalDateTime
  +calculateBalance(accountId: Account.AccountId): Money
  +getActivities(): List<Activity>
  +addActivity(activity: Activity): void
}

class AccountBalanceService {
  -accountRepository: AccountJpaRepository
  -activityRepository: ActivityJpaRepository
  -accountMapper: AccountMapper
  --
  +getAccountBalance(query: AccountBalanceQuery): Money
}

class AccountDepositService {
  -accountRepository: AccountJpaRepository
  -activityRepository: ActivityJpaRepository
  -accountMapper: AccountMapper
  --
  +deposit(command: AccountDepositCommand): boolean
}

class AccountListAllService {
  -accountRepository: AccountJpaRepository
  -activityRepository: ActivityJpaRepository
  -accountMapper: AccountMapper
  --
  +listAccounts(): List<Account>
}

class AccountWithdrawService {
  -accountRepository: AccountJpaRepository
  -activityRepository: ActivityJpaRepository
  -accountMapper: AccountMapper
  --
  +withdraw(command: AccountWithdrawCommand): boolean
}

class MoneyTransferProperties {
  -maximumTransferThreshold: Money = Money.of(1_000_000L)
}

class AccountCreateService {
  -accountRepository: AccountJpaRepository
  --
  +createAccount(command: AccountCreateCommand): AccountId
}

class AccountSendMoneyService {
  -accountRepository: AccountJpaRepository
  -activityRepository: buckpal.data.repository.ActivityJpaRepository
  -accountLock: AccountLock
  -moneyTransferProperties: MoneyTransferProperties
  -accountMapper: AccountMapper
  --
  +sendMoney(command: AccountSendMoneyCommand): boolean
  -checkThreshold(command: AccountSendMoneyCommand): void
}

class ThresholdExceededException {
  +ThresholdExceededException(threshold: Money, actual: Money)
}

class BuckPalConfiguration {
  +moneyTransferProperties(buckPalConfigurationProperties: BuckPalConfigurationProperties): MoneyTransferProperties
}

interface AccountLock {
  ~lockAccount(accountId: AccountId): void
  ~releaseAccount(accountId: AccountId): void
}

class NoOpAccountLock {
  +lockAccount(accountId: AccountId): void
  +releaseAccount(accountId: AccountId): void
}

class PositiveMoneyValidator {
  +isValid(value: Money, context: ConstraintValidatorContext): boolean
}

class Validation {
  -{static} validator: Validator = buildDefaultValidatorFactory().getValidator()
  --
  +{static} validate(subject: T): void
}

interface ActivityJpaRepository {
  ~findByOwner(ownerAccountId: long): List<ActivityJpaEntity>
  ~getDepositBalanceUntil(accountId: long, until: LocalDateTime): Optional<Long>
  ~getWithdrawalBalanceUntil(accountId: long, until: LocalDateTime): Optional<Long>
}

interface AccountJpaRepository {
}

class ActivityJpaEntity {
  -id: Long
  -timestamp: LocalDateTime
  -ownerAccountId: long
  -sourceAccountId: long
  -targetAccountId: long
  -amount: long
}

class AccountJpaEntity {
  -id: Long
  -baselineBalance: Long
}

class AccountBalanceController {
  -accountBalanceService: AccountBalanceService
  --
  ~getAccountBalance(accountId: Long): BalanceResponse
}

class AccountSendMoneyController {
  -sendMoneyService: AccountSendMoneyService
  -accountBalanceService: AccountBalanceService
  --
  ~sendMoney(sourceAccountId: Long, targetAccountId: Long, amount: Long): SendMoneyResponse
}

class AccountWithdrawController {
  -accountWithdrawService: AccountWithdrawService
  -accountBalanceService: AccountBalanceService
  --
  ~withdraw(accountId: Long, amount: Long): WithdrawResponse
}

class AccountCreateController {
  -createAccountService: AccountCreateService
  --
  ~createAccount(initialBalance: Long): CreateResponse
}

class AccountDepositController {
  -accountDepositService: AccountDepositService
  -accountBalanceService: AccountBalanceService
  --
  ~deposit(accountId: Long, amount: Long): DepositResponse
}

class AccountListAllController {
  -listAccountsService: AccountListAllService
  --
  ~listAccounts(): ListResponse
}

AccountMapper ..> AccountJpaEntity
AccountMapper ..> Account
AccountMapper ..> ActivityWindow
AccountMapper ..> Activity
AccountMapper ..> ActivityJpaEntity
Activity *-- ActivityId
Activity *-- AccountId
Activity *-- Money
Account *-- AccountId
Account *-- Money
Account *-- ActivityWindow
Account ..> Account
Money --> Money
ActivityWindow o-- Activity
ActivityWindow ..> AccountId
ActivityWindow ..> Money
AccountBalanceService *-- AccountJpaRepository
AccountBalanceService *-- ActivityJpaRepository
AccountBalanceService *-- AccountMapper
AccountBalanceService ..> Money
AccountDepositService *-- AccountJpaRepository
AccountDepositService *-- ActivityJpaRepository
AccountDepositService *-- AccountMapper
AccountListAllService *-- AccountJpaRepository
AccountListAllService *-- ActivityJpaRepository
AccountListAllService *-- AccountMapper
AccountWithdrawService *-- AccountJpaRepository
AccountWithdrawService *-- ActivityJpaRepository
AccountWithdrawService *-- AccountMapper
MoneyTransferProperties *-- Money
AccountCreateService *-- AccountJpaRepository
AccountCreateService ..> AccountId
AccountSendMoneyService *-- AccountJpaRepository
AccountSendMoneyService *-- ActivityJpaRepository
AccountSendMoneyService *-- AccountLock
AccountSendMoneyService *-- MoneyTransferProperties
AccountSendMoneyService *-- AccountMapper
ThresholdExceededException ..> Money
BuckPalConfiguration ..> BuckPalConfigurationProperties
BuckPalConfiguration ..> MoneyTransferProperties
AccountLock ..> AccountId
NoOpAccountLock ..|> AccountLock
NoOpAccountLock ..> AccountId
PositiveMoneyValidator ..> Money
AccountBalanceController *-- AccountBalanceService
AccountSendMoneyController *-- AccountSendMoneyService
AccountSendMoneyController *-- AccountBalanceService
AccountWithdrawController *-- AccountWithdrawService
AccountWithdrawController *-- AccountBalanceService
AccountCreateController *-- AccountCreateService
AccountDepositController *-- AccountDepositService
AccountDepositController *-- AccountBalanceService
AccountListAllController *-- AccountListAllService
@enduml