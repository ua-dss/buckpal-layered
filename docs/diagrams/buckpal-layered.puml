' Generated by UML Generator
' Encoded: pLXBSzis4BxxL_18rPR6lN8IJUH7E-eeSMehQIUTJWOYOHarI31ys77JvBTt0H8WdgJ6aqCE6SN0xkBR1x3VybNTeAffStfKtvEYH1NAevIYkburJKLsROFNAIjkoByuEZsw8ncEKbAb51yT2Qdeh4tlto9wpefRicyhr11MlArOYQk6u3hwSXH5ywP2HNsBg-rTXUixHhCaegpOHo-Z3VmiNg_-_FX-jNbtUVJLihegIqfIOLDOElu2Q1kIVeroH8eOLViwYMu0Px7_w-zP4ZqmaWr6LcdAsg9vZKf0q-ddgDoo2yQrBuk6D4ynweGIAVrRYRgTamYb3NaWt8qasf2wUR7g5fwKp7AczC3wDs5T2lr1YemzneSQqPKKKYKZpJmDefgM4jDzxxQw191i45vdV8Kz5hZgeQypvSL2BN6XchLLYgUae7xsk9cK8Zc6vEKbX86bY5wW1czXZU_bhC3WsMl-m_-Uym18lF4ar9De6kX9D0qJP08WJo8TuimDyphh0ls0Q8iJKTPE7Ugfq0ApGpMcfC1dYA8YnLeOa54KdYBf0gNkn2DfxbWBPcE_JLNH0Oj6CPjcmIPo8iSZzZrEWhI0VLYxAlbDH_I5Ec39zo4HQKiX5VqXN5G6YIlxbZdeh4AFiPwuS16iCr3UCKOnAaH58a3giM187MUuP3Lfh3D2nMYSOHV7Q049mzO3-E7o-ge_4jvHyRjWj_7fPYPA9-yUjJEoNnSDtkDAbGkfttBGv05VLHzmnMBJ9rA_mNl4jvqDgUTi_5fXo0uyxwYugYu_jOXksKZO38KHEUKh-DN7XRSDFSrA16LGeIe5ky6U4ir9qTRsQMgtf2ERwfIwtK4lIvk9emeUGQqUdUUYkmLTneCDOkayXLCjPJcRa5QzexyvDxptR-MZnm7RRpENkYooSHddWgAHLzQwl2i5JvYs0t0CYLMTmDi4lJs_1tA3gmUIOXbeiNNTNLfMWPdrqFI7PVtfjOHLkxMbDQAHcBn39N5uTsIKFhMuUaeioB_pHL_b2A6BxjmVoI_v2AOipr4nPBo7UjujZpnzFEShIdyadoY7rEtePIaMbeu3ibFyI1we_cUdHO8ToOielMtFsMqkdwFF96_phKlfdLxqyyVJqrF-RpDpOdOkEi2p8oPyJ8MDNiHnj3jXS7CWNJQM6rna0lHtJU0EHfWIqKM66hIerCPYCh7mlDuFP_6_54TsavA4idLmfTJIUoU2AYvkhO1oUeVJUvN-GvJDbrgfNdvECSwm-2s7KI-y7pTMqGcw2Qp3vUU-wRIV1FrXYtUZysmoCU_Emla0J0IeM7MBeCBqx0eytoZyJvOoydD74JyGhJ3aeCQ7IAj0l65NfNtcyU5d7Z_dJCaNHKJU8qhWAh1-42UrM92yhazZoY12du6tGdXhO5eGCALttktv7gnUHkPshlZQWrHEek7ybt0r2Sqky2rgwM3_5wWXk8ZnR06TMgt6CtVEwgtY6EZWFpW5k5lDTpV9naK7XBQGvpdeQk8M6DpPqnMVVvqfk6V2WKyAN1lSw7jmJotUmHxLKyTjd4GjNxPOdJwCyLb46fJT0z7lOTFXnSg1OLOMaz34zmDVRBpVB-I6CmRA3JatKTy0FuBE6OEzNm3wNLx95QEq_oWbdscJioP-AYkhyPjB9xKaRBhYw7UkSLt2VSBXncSZggsEc8HQvRFX3rt7IT96L92JecvP9gZtKE49-ZZm7M_GBUwM13ZTi_rKF0nDU28F33eY-OpfXi61R4m6oLAGJDf42dYZrNLMS3hL81X5xhr1DQUKn3-yF3kaSk2OYcX_ND27VkwmVT2vlut875KK8j-ue1zhVeXUB9REYn8MyUuOtm730YDR-idzb-AVvdFz8x6rBicpiTmDgVBxfYquhFhaV3uOZdVpn7o-LEh6nnEcMR7tD3CQP6tJ06HzBE3m_4n_LDv7wiCA9XVtopb0hUb_4gXVVWIeHy4Br1hP9u7uvKU0U1IyGEpHUn99G644Ya_3n1AQbvtADuVUIQock5tJ_j5rqcX8OoG2euU8-NHCC3GFZUcOyHsP58Shuftq-FRum1RM2-4sHZSpAVQGjLZyjpG3vKhe-e61AVHWQPrB2vhLDKUedgRayBh3rFndUIYNfcCpguEK_0Svb4ZJCBbFaBPe6XOzEKJ53yib5fgAHI5UGO3RdFuF
' URL: http://www.plantuml.com/plantuml/uml/pLXBSzis4BxxL_18rPR6lN8IJUH7E-eeSMehQIUTJWOYOHarI31ys77JvBTt0H8WdgJ6aqCE6SN0xkBR1x3VybNTeAffStfKtvEYH1NAevIYkburJKLsROFNAIjkoByuEZsw8ncEKbAb51yT2Qdeh4tlto9wpefRicyhr11MlArOYQk6u3hwSXH5ywP2HNsBg-rTXUixHhCaegpOHo-Z3VmiNg_-_FX-jNbtUVJLihegIqfIOLDOElu2Q1kIVeroH8eOLViwYMu0Px7_w-zP4ZqmaWr6LcdAsg9vZKf0q-ddgDoo2yQrBuk6D4ynweGIAVrRYRgTamYb3NaWt8qasf2wUR7g5fwKp7AczC3wDs5T2lr1YemzneSQqPKKKYKZpJmDefgM4jDzxxQw191i45vdV8Kz5hZgeQypvSL2BN6XchLLYgUae7xsk9cK8Zc6vEKbX86bY5wW1czXZU_bhC3WsMl-m_-Uym18lF4ar9De6kX9D0qJP08WJo8TuimDyphh0ls0Q8iJKTPE7Ugfq0ApGpMcfC1dYA8YnLeOa54KdYBf0gNkn2DfxbWBPcE_JLNH0Oj6CPjcmIPo8iSZzZrEWhI0VLYxAlbDH_I5Ec39zo4HQKiX5VqXN5G6YIlxbZdeh4AFiPwuS16iCr3UCKOnAaH58a3giM187MUuP3Lfh3D2nMYSOHV7Q049mzO3-E7o-ge_4jvHyRjWj_7fPYPA9-yUjJEoNnSDtkDAbGkfttBGv05VLHzmnMBJ9rA_mNl4jvqDgUTi_5fXo0uyxwYugYu_jOXksKZO38KHEUKh-DN7XRSDFSrA16LGeIe5ky6U4ir9qTRsQMgtf2ERwfIwtK4lIvk9emeUGQqUdUUYkmLTneCDOkayXLCjPJcRa5QzexyvDxptR-MZnm7RRpENkYooSHddWgAHLzQwl2i5JvYs0t0CYLMTmDi4lJs_1tA3gmUIOXbeiNNTNLfMWPdrqFI7PVtfjOHLkxMbDQAHcBn39N5uTsIKFhMuUaeioB_pHL_b2A6BxjmVoI_v2AOipr4nPBo7UjujZpnzFEShIdyadoY7rEtePIaMbeu3ibFyI1we_cUdHO8ToOielMtFsMqkdwFF96_phKlfdLxqyyVJqrF-RpDpOdOkEi2p8oPyJ8MDNiHnj3jXS7CWNJQM6rna0lHtJU0EHfWIqKM66hIerCPYCh7mlDuFP_6_54TsavA4idLmfTJIUoU2AYvkhO1oUeVJUvN-GvJDbrgfNdvECSwm-2s7KI-y7pTMqGcw2Qp3vUU-wRIV1FrXYtUZysmoCU_Emla0J0IeM7MBeCBqx0eytoZyJvOoydD74JyGhJ3aeCQ7IAj0l65NfNtcyU5d7Z_dJCaNHKJU8qhWAh1-42UrM92yhazZoY12du6tGdXhO5eGCALttktv7gnUHkPshlZQWrHEek7ybt0r2Sqky2rgwM3_5wWXk8ZnR06TMgt6CtVEwgtY6EZWFpW5k5lDTpV9naK7XBQGvpdeQk8M6DpPqnMVVvqfk6V2WKyAN1lSw7jmJotUmHxLKyTjd4GjNxPOdJwCyLb46fJT0z7lOTFXnSg1OLOMaz34zmDVRBpVB-I6CmRA3JatKTy0FuBE6OEzNm3wNLx95QEq_oWbdscJioP-AYkhyPjB9xKaRBhYw7UkSLt2VSBXncSZggsEc8HQvRFX3rt7IT96L92JecvP9gZtKE49-ZZm7M_GBUwM13ZTi_rKF0nDU28F33eY-OpfXi61R4m6oLAGJDf42dYZrNLMS3hL81X5xhr1DQUKn3-yF3kaSk2OYcX_ND27VkwmVT2vlut875KK8j-ue1zhVeXUB9REYn8MyUuOtm730YDR-idzb-AVvdFz8x6rBicpiTmDgVBxfYquhFhaV3uOZdVpn7o-LEh6nnEcMR7tD3CQP6tJ06HzBE3m_4n_LDv7wiCA9XVtopb0hUb_4gXVVWIeHy4Br1hP9u7uvKU0U1IyGEpHUn99G644Ya_3n1AQbvtADuVUIQock5tJ_j5rqcX8OoG2euU8-NHCC3GFZUcOyHsP58Shuftq-FRum1RM2-4sHZSpAVQGjLZyjpG3vKhe-e61AVHWQPrB2vhLDKUedgRayBh3rFndUIYNfcCpguEK_0Svb4ZJCBbFaBPe6XOzEKJ53yib5fgAHI5UGO3RdFuF
' Generated on: 2026-02-28T04:58:32.497693750

@startuml
skinparam classAttributeIconSize 0
hide circle

class BuckPalConfigurationProperties {
  -transferThreshold: long = Long.MAX_VALUE
}

class BuckPalApplication {
  +{static} main(args: String[]): void
}

class AccountMapper {
  +mapToDomainEntity(account: AccountJpaEntity, activities: List<ActivityJpaEntity>): Account
  ~mapToActivityWindow(activities: List<ActivityJpaEntity>): ActivityWindow
  +mapToJpaEntity(activity: Activity): ActivityJpaEntity
}

class Activity {
  -id: ActivityId
  -ownerAccountId: Account.AccountId
  -sourceAccountId: Account.AccountId
  -targetAccountId: Account.AccountId
  -timestamp: LocalDateTime
  -money: Money
  --
  +Activity(ownerAccountId: Account.AccountId, sourceAccountId: Account.AccountId, targetAccountId: Account.AccountId, timestamp: LocalDateTime, money: Money)
}

class ActivityId {
  -value: Long
}

class Account {
  -id: AccountId
  -baselineBalance: Money
  -activityWindow: ActivityWindow
  --
  +{static} withoutId(baselineBalance: Money, activityWindow: ActivityWindow): Account
  +{static} withId(accountId: AccountId, baselineBalance: Money, activityWindow: ActivityWindow): Account
  +getId(): Optional<AccountId>
  +calculateBalance(): Money
  +getBalance(): Money
  +withdraw(money: Money, targetAccountId: AccountId): boolean
  -mayWithdraw(money: Money): boolean
  +deposit(money: Money, sourceAccountId: AccountId): boolean
}

class AccountId {
  -value: Long
}

class Money {
  +{static} ZERO: Money = Money.of(0L)
  -amount: BigInteger
  --
  +isPositiveOrZero(): boolean
  +isNegative(): boolean
  +isPositive(): boolean
  +isGreaterThanOrEqualTo(money: Money): boolean
  +isGreaterThan(money: Money): boolean
  +{static} of(value: long): Money
  +{static} add(a: Money, b: Money): Money
  +minus(money: Money): Money
  +plus(money: Money): Money
  +{static} subtract(a: Money, b: Money): Money
  +negate(): Money
}

class ActivityWindow {
  -activities: List<Activity>
  --
  +ActivityWindow(activities: List<Activity>)
  +ActivityWindow(activities: Activity)
  +getStartTimestamp(): LocalDateTime
  +getEndTimestamp(): LocalDateTime
  +calculateBalance(accountId: Account.AccountId): Money
  +getActivities(): List<Activity>
  +addActivity(activity: Activity): void
}

class AccountBalanceService {
  -accountRepository: IAccountJpaRepository
  -activityRepository: IActivityJpaRepository
  -accountMapper: AccountMapper
  --
  +getAccountBalance(query: AccountBalanceQuery): Money
}

class AccountDepositService {
  -accountRepository: IAccountJpaRepository
  -activityRepository: IActivityJpaRepository
  -accountMapper: AccountMapper
  --
  +deposit(command: AccountDepositCommand): boolean
}

class AccountListAllService {
  -accountRepository: IAccountJpaRepository
  -activityRepository: IActivityJpaRepository
  -accountMapper: AccountMapper
  --
  +listAccounts(): List<Account>
}

class AccountWithdrawService {
  -accountRepository: IAccountJpaRepository
  -activityRepository: IActivityJpaRepository
  -accountMapper: AccountMapper
  --
  +withdraw(command: AccountWithdrawCommand): boolean
}

class MoneyTransferProperties {
  -maximumTransferThreshold: Money = Money.of(1_000_000L)
}

class AccountCreateService {
  -accountRepository: IAccountJpaRepository
  --
  +createAccount(command: AccountCreateCommand): AccountId
}

class AccountSendMoneyService {
  -accountRepository: IAccountJpaRepository
  -activityRepository: buckpal.data.repository.IActivityJpaRepository
  -accountLock: IAccountLock
  -moneyTransferProperties: MoneyTransferProperties
  -accountMapper: AccountMapper
  --
  +sendMoney(command: AccountSendMoneyCommand): boolean
  -checkThreshold(command: AccountSendMoneyCommand): void
}

class ThresholdExceededException {
  +ThresholdExceededException(threshold: Money, actual: Money)
}

class BuckPalConfiguration {
  +moneyTransferProperties(buckPalConfigurationProperties: BuckPalConfigurationProperties): MoneyTransferProperties
}

interface IAccountLock {
  ~lockAccount(accountId: AccountId): void
  ~releaseAccount(accountId: AccountId): void
}

class NoOpAccountLock {
  +lockAccount(accountId: AccountId): void
  +releaseAccount(accountId: AccountId): void
}

class PositiveMoneyValidator {
  +isValid(value: Money, context: ConstraintValidatorContext): boolean
}

class Validation {
  -{static} validator: Validator = buildDefaultValidatorFactory().getValidator()
  --
  +{static} validate(subject: T): void
}

interface IAccountJpaRepository {
}

interface IActivityJpaRepository {
  ~findByOwner(ownerAccountId: long): List<ActivityJpaEntity>
  ~getDepositBalanceUntil(accountId: long, until: LocalDateTime): Optional<Long>
  ~getWithdrawalBalanceUntil(accountId: long, until: LocalDateTime): Optional<Long>
}

class ActivityJpaEntity {
  -id: Long
  -timestamp: LocalDateTime
  -ownerAccountId: long
  -sourceAccountId: long
  -targetAccountId: long
  -amount: long
}

class AccountJpaEntity {
  -id: Long
  -baselineBalance: Long
}

class AccountBalanceController {
  -accountBalanceService: AccountBalanceService
  --
  ~getAccountBalance(accountId: Long): BalanceResponse
}

class AccountSendMoneyController {
  -sendMoneyService: AccountSendMoneyService
  -accountBalanceService: AccountBalanceService
  --
  ~sendMoney(sourceAccountId: Long, targetAccountId: Long, amount: Long): SendMoneyResponse
}

class AccountWithdrawController {
  -accountWithdrawService: AccountWithdrawService
  -accountBalanceService: AccountBalanceService
  --
  ~withdraw(accountId: Long, amount: Long): WithdrawResponse
}

class AccountCreateController {
  -createAccountService: AccountCreateService
  --
  ~createAccount(initialBalance: Long): CreateResponse
}

class AccountDepositController {
  -accountDepositService: AccountDepositService
  -accountBalanceService: AccountBalanceService
  --
  ~deposit(accountId: Long, amount: Long): DepositResponse
}

class AccountListAllController {
  -listAccountsService: AccountListAllService
  --
  ~listAccounts(): ListResponse
}

AccountMapper ..> AccountJpaEntity
AccountMapper ..> Account
AccountMapper ..> ActivityWindow
AccountMapper ..> Activity
AccountMapper ..> ActivityJpaEntity
Activity *-- ActivityId
Activity *-- AccountId
Activity *-- Money
Account *-- AccountId
Account *-- Money
Account *-- ActivityWindow
Account ..> Account
Money --> Money
ActivityWindow o-- Activity
ActivityWindow ..> AccountId
ActivityWindow ..> Money
AccountBalanceService *-- IAccountJpaRepository
AccountBalanceService *-- IActivityJpaRepository
AccountBalanceService *-- AccountMapper
AccountBalanceService ..> Money
AccountDepositService *-- IAccountJpaRepository
AccountDepositService *-- IActivityJpaRepository
AccountDepositService *-- AccountMapper
AccountListAllService *-- IAccountJpaRepository
AccountListAllService *-- IActivityJpaRepository
AccountListAllService *-- AccountMapper
AccountWithdrawService *-- IAccountJpaRepository
AccountWithdrawService *-- IActivityJpaRepository
AccountWithdrawService *-- AccountMapper
MoneyTransferProperties *-- Money
AccountCreateService *-- IAccountJpaRepository
AccountCreateService ..> AccountId
AccountSendMoneyService *-- IAccountJpaRepository
AccountSendMoneyService *-- IActivityJpaRepository
AccountSendMoneyService *-- IAccountLock
AccountSendMoneyService *-- MoneyTransferProperties
AccountSendMoneyService *-- AccountMapper
ThresholdExceededException ..> Money
BuckPalConfiguration ..> BuckPalConfigurationProperties
BuckPalConfiguration ..> MoneyTransferProperties
IAccountLock ..> AccountId
NoOpAccountLock ..|> IAccountLock
NoOpAccountLock ..> AccountId
PositiveMoneyValidator ..> Money
AccountBalanceController *-- AccountBalanceService
AccountSendMoneyController *-- AccountSendMoneyService
AccountSendMoneyController *-- AccountBalanceService
AccountWithdrawController *-- AccountWithdrawService
AccountWithdrawController *-- AccountBalanceService
AccountCreateController *-- AccountCreateService
AccountDepositController *-- AccountDepositService
AccountDepositController *-- AccountBalanceService
AccountListAllController *-- AccountListAllService
@enduml